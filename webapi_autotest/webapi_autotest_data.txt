*** Settings ***
Library    ArtisanCustomLibrary
Resource   ../common_keywords.txt

*** Variables ***
${android_java_crash.json}    ${CURDIR}/jsondata/android/android_java_crash.json    # android的java崩溃日志
${android_normal.json}    ${CURDIR}/jsondata/android/android_normal.json    # android的session日志
${app_id}         Aw3z14mK
${test_app_id}    g2n0qB9y
${test_app_id}    g2n0qB9y
${sdk_ip}         http://127.0.0.1    # 接收sdk日志的目标服务器ip: github上已使用虚假地址屏蔽，保证安全
${test_sdk_ip}    http://192.168.1.1
${query_ip}       http://127.0.0.1:10086    # 查询统计数据的ip和端口

*** Keywords ***
send_session_and_crash
    [Documentation]    关键字:发送1条session和crash
    ${date}=    Get Time    epoch    UTC+8 hour    # 获取当前UTC时间
    ${date_string}=    Evaluate    ${date}*1000    # 被测系统的时间需要*1000
    ${date}=    Convert To Integer    ${date_string}
    editJson    ${android_normal.json}    app_key=${test_app_id}    date=${date}
    editJson    ${android_java_crash.json}    app_key=${test_app_id}    date=${date}
    post_sdk_event    ${android_normal.json}    ${test_sdk_ip}
    sleep    1
    post_sdk_event    ${android_java_crash.json}    ${test_sdk_ip}
    sleep    3

send_session_and_crash_use_new_device
    [Documentation]    关键字:发送1条session和crash,使用新设备,device_id用当前时间,以确保不会重复
    [Arguments]     ${send_times}
    ${date}=    Get Time    epoch    UTC+8 hour    # 获取当前UTC时间
    ${date}=    Evaluate    ${date}*1000    # 被测系统的时间精确到毫秒
    ${date}=    Convert To Integer    ${date}
    ${device_id}=      Convert To String    ${date}
    editJson    ${android_normal.json}    app_key=${test_app_id}    date=${date}    device_id=${device_id}
    editJson    ${android_java_crash.json}    app_key=${test_app_id}    date=${date}    device_id=${device_id}
    :for    ${i}   in range   ${send_times}
    \    post_sdk_event    ${android_normal.json}    ${test_sdk_ip}
    \    sleep    1
    \    post_sdk_event    ${android_java_crash.json}    ${test_sdk_ip}
    sleep    3